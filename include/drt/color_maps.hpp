#ifndef DRT_COLOR_MAPS_HPP
#define DRT_COLOR_MAPS_HPP
#include <algorithm>
#include <array>
#include <drt/vec.hpp>

namespace drt {

template<typename Real>
vec<Real, 3> grayscale(Real scalar) {
    // I *think* the clamp is the correct decision here; could surprise someone who doesn't rescale their data,
    // but throwing an exception could make big trouble on numerical error.
    scalar = std::clamp(scalar, Real(0), Real(1));
    auto color = vec<Real, 3>(scalar, scalar, scalar);
    return color;
}

// Taken from https://www.kennethmoreland.com/color-advice/
// awk -F"," '{printf "%s%s",sep,$2; sep=","} END{print ""}' ~/Downloads/plasma-table-float-0256.csv
template<typename Real>
constexpr const std::array<Real, 256> plasma_r{0.18500126283629117,0.1911189044113562,0.19712864908128114,0.2030416233571155,0.20887268107458867,0.21463072331602523,0.22032157730150803,0.2259575605729931,0.23155039796588678,0.23710641646603325,0.24262940495715968,0.24812510063567056,0.25359583439603345,0.259047386098491,0.26447987886309154,0.2698981057405734,0.2753043830681906,0.28069900692141886,0.28608641029403303,0.2914638822295278,0.29683511768078935,0.3021991776471102,0.307559383374685,0.31291664864816615,0.31826993831935324,0.3236225760753923,0.3289709965431237,0.33431870303843003,0.33966373680896456,0.3450078077262057,0.35034847407826647,0.3556874153529715,0.36102581201779066,0.3663615341003603,0.37169632394652985,0.3770276964703286,0.382357946820387,0.38768438207138256,0.3930062860759083,0.3983273716748813,0.4036425817932003,0.40895431552409317,0.41426001622424247,0.4195623952577179,0.4248563616485503,0.4301441775161412,0.4354268819265687,0.4406999402134,0.44596644643576516,0.45122228710713624,0.4564697629199718,0.4617056654598785,0.4669310023070961,0.47214475738324385,0.4773458407394621,0.48253461632433253,0.4877090328365206,0.49286905392912533,0.49801338714995985,0.5031412603622233,0.5082531828521651,0.5133462124834312,0.5184220260592395,0.5234778559822143,0.5285143492877827,0.5335306956538576,0.5385244789001884,0.5434980954707963,0.5484481027774952,0.5533750875909487,0.5582766534405778,0.5631554062153734,0.5680081900745759,0.5728333975138157,0.5776342744306816,0.5824076737546731,0.5871533984089229,0.5918701205096012,0.5965604367679973,0.6012201835310419,0.6058512183412395,0.6104521263820015,0.6150225220246975,0.6195628616073623,0.6240719801812181,0.6285513580399021,0.6329989221793823,0.6374162963015114,0.6418004809769666,0.6461536800309777,0.650476135769243,0.6547651168217998,0.6590245256639604,0.6632516551223815,0.6674477291126537,0.6716108031251352,0.6757429658756737,0.6798454057970371,0.6839159522860683,0.6879568949603344,0.6919652822236589,0.6959450042288188,0.6998941469583252,0.7038136863269572,0.7077036076142078,0.7115648684573126,0.7153974874768007,0.7192003105763611,0.7229763232162184,0.7267244865470727,0.7304437173416366,0.7341377518333918,0.7378037499188499,0.7414454244046753,0.7450587348350122,0.7486483346580772,0.7522104746641185,0.755748680542265,0.7592629017974487,0.7627520603974456,0.766216825373388,0.7696582925955131,0.773077107895631,0.7764713899964052,0.7798428195281752,0.7831920638854646,0.7865182091233281,0.7898228934175395,0.7931051428523151,0.7963656261858302,0.7996034565968984,0.8028201310987728,0.8060159189746301,0.8091884512009491,0.8123413974246995,0.8154719410234268,0.8185825533178849,0.8216705444481089,0.8247373765508464,0.8277822680188923,0.8308060259837033,0.8338091392025193,0.8367899778785102,0.8397489706421578,0.8426854482941508,0.8456008173688659,0.8484934838710892,0.8513631273192183,0.8542102862752687,0.8570334035212495,0.8598348399896373,0.8626110724885258,0.8653643579173034,0.8680923147108822,0.8707954368901418,0.8734743717670276,0.8761266641066531,0.8787535738894046,0.8813526771710705,0.8839261632148947,0.8864707162026111,0.8889878746971145,0.8914771762860599,0.8939362684731502,0.896366404995977,0.8987661885216094,0.9011348456797987,0.9034710462469783,0.9057762624345291,0.9080481396866358,0.9102863527112363,0.9124909968821041,0.9146608551755517,0.9167960662705978,0.9188933135427245,0.9209542277904884,0.9229781644169556,0.9249630587811338,0.9269098852966564,0.928815526839391,0.9306829366142825,0.9325070229302802,0.9342897265833519,0.9360290542859102,0.9377243972740386,0.9393770933973468,0.9409842661949558,0.9425456696997273,0.9440594310662802,0.9455271344382453,0.9469451155697922,0.9483136189409812,0.9496329509923357,0.9509013387619204,0.9521193680507284,0.9532833326102016,0.9543957893212712,0.9554530885899511,0.9564564274893136,0.9574039803720095,0.9582930778369493,0.9591252451658657,0.9598979045875052,0.9606124721276129,0.9612663555645452,0.9618587615061226,0.9623887555724971,0.9628559105126825,0.9632594414845331,0.9635970174364671,0.9638686962955997,0.964073330664618,0.9642088982457305,0.9642762050566095,0.9642722292530789,0.9641978734579372,0.9640500241140576,0.9638285003224122,0.9635333683894992,0.9631614522931872,0.962712538770477,0.9621866932888067,0.9615816256657105,0.960894345402275,0.9601234461397462,0.959270237581007,0.958333448735586,0.9573126236007495,0.9562062303425974,0.9550135580216242,0.9537297610630108,0.9523531724953679,0.9508874276947369,0.9493337129963176,0.9476874510448859,0.9459406787196255,0.944103300221897,0.9421780061800054,0.9401426587007371,0.9380209885848168,0.9358000817994506,0.9334816723713976,0.9310720730839354,0.9285606186650813,0.9259594465149981,0.92327053647064,0.9204816890380406,0.9176163146663037,0.9146765909646813,0.9116700174610778,0.9086068264551928,0.9055122790291467,0.9024220298268155,0.8994080090565665,0.8965597700566809,0.894058310302958};

template<typename Real>
constexpr const std::array<Real, 256> plasma_g{0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,3.874898278890354e-05,0.007471928506941776,0.015271185178250529,0.023435206026773358,0.03197423156761071,0.04087712538541078,0.04941897732161648,0.057376591831635744,0.06489209701289092,0.07205664723234939,0.07893485649247015,0.08557896376179144,0.092021751309049,0.09829643543437619,0.10442077591051005,0.11041573939018576,0.11629982277048792,0.12207972438632506,0.12777061405330994,0.13337789223781238,0.1389126551987294,0.14437902230001867,0.14978346343836335,0.15513277880704496,0.16042886120342012,0.1656775394015491,0.1708811060968512,0.17604431343185956,0.1811675458797579,0.1862549283640475,0.19131016034079534,0.19633283758483017,0.20132751808066945,0.20629365678022926,0.21123542314263571,0.2161517783484883,0.22104657452100646,0.22592119959006707,0.23077446982485766,0.23561210642337616,0.24043047593352906,0.24523511752950322,0.2500223780012234,0.25479746355598837,0.25956029374277906,0.26431022207991034,0.2690513274100934,0.2737818849425285,0.27850483541745347,0.28321834594018785,0.28792637941737553,0.29262694015300356,0.2973217868017699,0.30201349640843383,0.3067011675000855,0.311386513443518,0.3160685293738308,0.3207499291278433,0.3254307091326806,0.33011024027988417,0.3347921147847294,0.3394741977280383,0.3441601465946952,0.3488478095363264,0.3535397891569865,0.3582349147529724,0.36293457844520105,0.3676412168097567,0.3723536223699429,0.3770733241910323,0.38179911504484987,0.3865345827145719,0.3912774119706224,0.3960300112396703,0.40079369284363137,0.4055661645442056,0.4103509864051946,0.4151458393212769,0.41995530212234555,0.4247759985436038,0.429609255031397,0.4344584280288323,0.4393211443376441,0.4441999304447296,0.4490924088928135,0.4540021452370879,0.4589267217483421,0.46386948406587364,0.4688297189338491,0.4738069993796045,0.47880391802811756,0.4838189959751383,0.4888528043494526,0.4939069187369674,0.4989795927548926,0.5040742179411092,0.5091882394741989,0.5143242934939541,0.519480841366499,0.5246605189695782,0.529860774144959,0.5350842629867526,0.5403293668305715,0.5455974579589155,0.5508899121603867,0.5562040647384632,0.5615426592562283,0.5669040105140666,0.5722919147836466,0.577701610932102,0.5831365219782882,0.5885970455193761,0.5940804364977416,0.5995905102669348,0.6051244958149699,0.6106842151090096,0.6162678665363043,0.6218768875923327,0.627512735634536,0.6331745970184661,0.6388623236974159,0.6445750605508336,0.6503137041961821,0.656078387432029,0.6618685638537222,0.6676857251951027,0.6735279399230053,0.6793971833342757,0.6852914897975773,0.6912138827190051,0.6971603311791722,0.7031323629811758,0.7091335377504808,0.7151587894894975,0.7212111928588061,0.727288688382748,0.7333943830627802,0.7395241540309135,0.7456795754640698,0.7518622221225512,0.7580699614625952,0.7643039444114984,0.7705640387323482,0.7768514277320878,0.7831628955092512,0.7894990412104851,0.7958624980435167,0.8022480152561944,0.8086588498956894,0.8150957971478479,0.8215591141377789,0.8280444859186529,0.8345532077754317,0.8410839962117271,0.8476425831870477,0.8542225467143049,0.8608205474618611,0.8674491093347713,0.8740937063216282,0.8807618316376675,0.8874501087536273,0.8941562294005477,0.900886023729324,0.9076310541062192,0.9143938321288543,0.9211760913964651,0.9279732997552812,0.9347791439177715,0.9415965873644457,0.9484236309855288,0.9552511244435956,0.9620729727476299,0.9688661897650951,0.975611979389701,0.9822535793047805};

template<typename Real>
constexpr const std::array<Real, 256> plasma_b{0.5300734481832133,0.5352444603525081,0.5401496873258278,0.5448207274312517,0.5492861078596931,0.5535696573805636,0.5576886141014704,0.5616609964897479,0.5655049239276769,0.5692314014828168,0.5728505620174764,0.5763702949099744,0.5797988437955895,0.5831429817760583,0.5864060347449428,0.5895948785151374,0.5927123254827708,0.5957607906567519,0.5987448538514638,0.6016649977484743,0.6045237142774258,0.6073215647568714,0.610060282216021,0.6127415605257925,0.6153640224697419,0.6179290152489123,0.6204342239271381,0.6228829350718792,0.625271898043606,0.6276013187112769,0.6298710242222681,0.6320785940805594,0.6342255823320162,0.6363078797194855,0.6383265475601053,0.6402785532144175,0.6421628771547095,0.6439785694946553,0.6457230933084593,0.6473958766593488,0.6489950538473048,0.6505184306872968,0.6519642297582939,0.653331171675656,0.6546165641245861,0.655818742117949,0.65693799619788,0.6579697282780315,0.658913466231862,0.6597667197389312,0.6605289119772367,0.6611976600287218,0.6617721467945837,0.6622494877377035,0.6626294254823041,0.662909148803712,0.6630875095523548,0.6631645872632188,0.66313835041097,0.6630068027529852,0.6627708908204921,0.6624287113415619,0.6619800968378087,0.6614242681940923,0.6607599298174441,0.6599874350032627,0.6591055981902831,0.6581161801158861,0.6570196633950978,0.6558144934883569,0.6545022813523073,0.653083356821114,0.651560454782398,0.6499322013289422,0.6482001697143078,0.6463672240776391,0.6444334413675159,0.6424018048025009,0.6402732833430833,0.6380499641554425,0.6357347102857865,0.6333297196772426,0.6308373994447983,0.6282600961681855,0.6256021241199032,0.6228641296151941,0.6200505178730409,0.6171638506919247,0.6142086153036438,0.6111870741109839,0.6081004450341899,0.604956300073173,0.6017530389476595,0.5984983035745908,0.5951924266541045,0.5918411070177483,0.5884465014386215,0.585011735976789,0.5815395577903398,0.5780332012739695,0.5744974521016776,0.570932506897979,0.5673441858884501,0.5637335767466599,0.5601017463095771,0.5564545500366853,0.552792120928892,0.5491173170199668,0.545432268052493,0.5417408483359869,0.5380431032601405,0.5343400883294095,0.5306366819504315,0.5269329923911534,0.5232298863541315,0.5195274755763871,0.5158306312483361,0.512137399653064,0.5084498297525021,0.50476878993514,0.501093374729771,0.49742746464864046,0.49377016285413927,0.4901233238126223,0.4864869893410944,0.48285922068624404,0.47924185046887885,0.4756350094982365,0.4720385174170281,0.4684525186264465,0.4648778196983237,0.4613125719281808,0.4577605762350459,0.45421788462774554,0.45068557847021135,0.4471634196988565,0.4436495949958711,0.44014585494792785,0.43665038594107897,0.43316392259011754,0.4296875651350407,0.42621737099556123,0.42275507747129093,0.41929886852490544,0.41584947056189187,0.4124050878709716,0.4089674228462569,0.405535554348405,0.4021065453700518,0.3986820908198349,0.39526040918192384,0.3918421707163013,0.38842457298679345,0.385011298212545,0.38159840245673277,0.3781859518708741,0.37477461745019225,0.37136257807629336,0.36795049364876287,0.3645365324577698,0.3611223530824753,0.35770601202584773,0.3542865122627056,0.35086450022751575,0.34744014111882704,0.34401206951565483,0.34058041413685886,0.33714480107622696,0.3337042204871271,0.33025867912310986,0.3268087806988829,0.32335261768909423,0.31989179322193145,0.31642542736448936,0.31295201716155624,0.30947360171764265,0.30598704730811505,0.3024949522990142,0.2989963432701857,0.29549074588061,0.29197919964809826,0.28845817867177614,0.28492969964810494,0.28139526496601874,0.2778537072388743,0.27430383727935276,0.2707481638305188,0.26718454740444175,0.2636154464355518,0.2600356289949842,0.2564496036120887,0.25285703768193385,0.24925763348723312,0.2456517661988547,0.24204016134332634,0.23842311536200755,0.2348003777648286,0.23117419840272618,0.22754413813760505,0.22390965714476324,0.2202708516770076,0.21662943633800064,0.21298749726033284,0.20934668932625894,0.2057069050257183,0.20207065907463867,0.1984392920478823,0.19481481252537644,0.19119869381163737,0.18759494102079383,0.18400288978976168,0.1804297764591602,0.17687797122612808,0.17334762525376426,0.16984714768059186,0.16637921636618158,0.16295000971437262,0.15956346939328955,0.15622826644396326,0.15294946537452883,0.14973455824735152,0.1465937236780026,0.143534307799379,0.1405644983355272,0.1376912476803779,0.1349304220039219,0.13229401208376287,0.129792103544935,0.12743980433391283,0.12524775464689872,0.12322300321471347,0.12137867908430083,0.11973149121600749,0.118292153356203,0.11706646197810774,0.11605402308057439,0.11527104051689083,0.11471851258263263,0.11437731754446762,0.1142616518784757,0.11434747323584868,0.1146183402870086,0.11505417484570082,0.11561141583641374,0.11625593038842527,0.1169286187796818,0.11754606974768209,0.11802695488214923,0.11824175235960144,0.11802059587857097,0.11712470175631184,0.1152182936223895,0.11179479561713918,0.10607343156231328,0.09668148446675398,0.0810687655704728};

template<typename Real>
vec<Real, 3> plasma(Real scalar) {
    scalar = std::clamp(scalar, Real(0), Real(1));
    constexpr const Real h = Real(1)/(plasma_r<Real>.size()-1);
    Real ii = std::floor(scalar/h);
    int i = static_cast<int64_t>(ii);
    Real t = scalar/h - ii;
    auto color = vec<Real, 3>((1-t)*plasma_r<Real>[i] + t*plasma_r<Real>[i+1],
                              (1-t)*plasma_g<Real>[i] + t*plasma_g<Real>[i+1],
                              (1-t)*plasma_b<Real>[i] + t*plasma_b<Real>[i+1]);
    return color;
}

template<typename Real>
constexpr const std::array<Real, 256> viridis_r{0.2823645529290169,0.28442016331743475,0.28640872215228885,0.28832801827269444,0.29017937839961166,0.2919602785108896,0.2936725695568318,0.2953145929546483,0.2968856990777091,0.2983864384776219,0.29981597062377513,0.3011730649474346,0.3024574616405568,0.3036695909467026,0.3048077646670268,0.3058726942921675,0.30686354185634795,0.3077802784412034,0.3086224941211352,0.3093909368237089,0.3100840531043614,0.3107021547526659,0.3112451783861907,0.3117137300318166,0.31210749532005316,0.3124264208600718,0.31267102574316064,0.31284284828449566,0.31293985716270956,0.3129647555680025,0.3129172762828141,0.3127980600772598,0.3126079674503442,0.3123476422504348,0.3120187867754984,0.3116232941035938,0.31115984744015995,0.3106312638671459,0.31003859809087064,0.30938382493792904,0.3086683938758612,0.30789302647936884,0.307058669956948,0.30616963655061763,0.3052269065043157,0.3042309077920497,0.30318432730096756,0.30208910989145576,0.3009472750064046,0.29976132132321154,0.29853340919581994,0.29726490390425825,0.29595755856435807,0.2946138805993375,0.2932353894530138,0.2918258704725537,0.290387139948913,0.2889195372181988,0.28742616289551665,0.28590907506551183,0.28436845691665213,0.28280885381705473,0.28123118105327793,0.2796382036694848,0.2780293659165648,0.27640874852219066,0.27477620046950885,0.2731336070036193,0.2714830730483761,0.26982545321488427,0.2681626147651372,0.26649507924006577,0.26482494588026595,0.2631526559675265,0.261479290708243,0.2598068996301584,0.2581351267096509,0.2564654875671387,0.25479666350991237,0.25313154461533993,0.25146893469049797,0.24980931862578432,0.24815451941163053,0.24650281919380035,0.2448554379333428,0.24321127505789647,0.24157208508670241,0.23993532100520137,0.23830244481673896,0.23667266390977104,0.23504468776110826,0.23341840155293508,0.23179414987893965,0.23017061991847487,0.2285458366653788,0.2269217957032748,0.2252950588660499,0.22366535734333398,0.22203317321082194,0.22039568222953204,0.2187534764148667,0.21710379387686735,0.21544640014275412,0.2137812367677258,0.21210435581990783,0.21041654636306228,0.2087156715163057,0.20700265458437167,0.2052740577019755,0.20352973151672893,0.20176907507316538,0.19999051193019307,0.1981942071395154,0.19637893240486903,0.19454390995867465,0.1926877983020047,0.1908096988450276,0.1889101064832561,0.1869882250558732,0.18504404737541283,0.18307650380221172,0.18108751106392554,0.179079069917763,0.17704851110868655,0.17499810635812427,0.1729271521674646,0.17084034495202932,0.16873518608371835,0.16661789658301376,0.16448693755461796,0.16235010494692595,0.1602069832547893,0.15806264119618174,0.15592085037000353,0.15378524571480254,0.15166304622295707,0.14955934468428786,0.14748163623723387,0.14543738134019324,0.14343467030926343,0.14148086657706913,0.13958716457678366,0.13776366739068555,0.13602091941109576,0.13437265977205576,0.13283238318759788,0.13141083773044995,0.13012562239437234,0.12898908642655502,0.12801762810243703,0.1272255861040811,0.12663084317706338,0.12624680080960696,0.12608994360406375,0.12617263740036105,0.1265110859590127,0.12711466919306777,0.12799581674473437,0.12916500542967113,0.13062688656598942,0.13238792426640142,0.1344529141545566,0.13682278693871636,0.13949652044856853,0.14247497810778012,0.14575022774163957,0.14932184918451274,0.1531793767768577,0.15731856380201292,0.16173071601073405,0.16640600246038467,0.17133854153234118,0.17651571973890343,0.1819300525085049,0.1875710313130601,0.19342964878541258,0.19949918559250934,0.2057678869700838,0.21222937521669094,0.21887342785296,0.2256970102409276,0.2326884687641787,0.23984379062888905,0.24715366801913152,0.25461342821257693,0.26221888931032444,0.26996266615436965,0.2778414184206625,0.2858480262057704,0.2939823104683633,0.3022350954370879,0.310604418737109,0.3190871961690892,0.32767842481037307,0.3363770709617544,0.3451757700977104,0.3540765354074894,0.36307288905435614,0.3721639204075886,0.3813479050465821,0.3906182241219263,0.3999768212623815,0.40941597344689007,0.418938095542911,0.42853611297072447,0.43821148499483115,0.4479617886413208,0.4577813910404001,0.46767297073952857,0.47762895833183777,0.4876519966897123,0.49773367432610355,0.5078750219432514,0.5180752494862431,0.5283258321751821,0.5386308275986138,0.548980458002187,0.5593788376902379,0.5698174276705644,0.5802945527724039,0.5908116383216248,0.6013580840397512,0.6119370906314997,0.6225401569353771,0.6331682881172852,0.6438129884912803,0.6544728151822515,0.6651461868847677,0.6758257194413555,0.6865115265930126,0.6971941434439218,0.7078748175056854,0.7185439321356931,0.7292039995694638,0.7398433313314975,0.7504625667873018,0.7610594940142685,0.7716234421245648,0.7821578637018753,0.7926533490577626,0.8031101670648537,0.8135200000367577,0.8238814958821538,0.8341953189844913,0.8444522250765154,0.8546555615949485,0.8647960127489654,0.8748769440175387,0.8848859474442141,0.8948269727230432,0.9047025295790283,0.9145057699880221,0.9242397319919776,0.9338985888012371,0.9434864385344409,0.9529994532916154};

template<typename Real>
constexpr const std::array<Real, 256> viridis_g{0.0,0.0,0.0,0.0,0.0026548744457282002,0.007927574441840031,0.013523701340444767,0.0194469283736754,0.025709272843022362,0.03232004345340847,0.039284989212368455,0.04626360509301145,0.05292448251262403,0.059347679387570774,0.0655767750733681,0.07164698633434458,0.07758748304703458,0.0834178665180236,0.08915477951604339,0.09481086300337191,0.10039934660784217,0.10592544707225837,0.111398995007257,0.11682684097453058,0.12221105850499253,0.12756000041340385,0.1328717148189205,0.13815390993203355,0.1434064187456714,0.14863302233253345,0.15383324394186293,0.1590082922293873,0.16416130934378315,0.16929153088387608,0.17439996402117275,0.17948560856731854,0.1845516383459222,0.189595868940358,0.19461776801237182,0.19962012298531123,0.20459957100719467,0.20955888696372615,0.21449483201644065,0.2194100154940718,0.22430118261968157,0.22916966474571626,0.2340159100780761,0.23883855539609794,0.24363810897601756,0.24841118674175394,0.2531623990240717,0.2578873976329164,0.2625874493056926,0.26726378849777516,0.27191415168129185,0.27653989400666285,0.28113768475292045,0.28571303833310896,0.29026061879591203,0.29478258938071067,0.2992802217180254,0.30375224020966846,0.30819892495661744,0.3126190607542608,0.3170149456432699,0.321385414500347,0.3257316254417039,0.3300547425253127,0.3343525579890229,0.33862832893130074,0.3428799001623282,0.34710848826302004,0.35131500140549954,0.3554995323434884,0.3596631879129328,0.36380486101494103,0.36792673591505964,0.3720277792587921,0.3761100924489166,0.3801736871524052,0.384219609636479,0.3882468863669942,0.39225657410893083,0.3962507215819094,0.40022836834946646,0.40419159051679776,0.40813938952902734,0.4120738222862286,0.41599392773534455,0.41990177352141406,0.4237973655416275,0.42768077962221346,0.43155402955947875,0.4354151520581061,0.4392682409766716,0.44311029176723954,0.4469443851124765,0.45077047699087197,0.45458770680091215,0.4583990258215093,0.4622025551537203,0.466001277474918,0.46979327601523685,0.4735795360665342,0.4773631248343298,0.4811400844455726,0.48491543980046187,0.4886862374146865,0.49245445289710926,0.4962192161230187,0.49998151568117394,0.5037433207187862,0.50750175769624,0.5112607523934385,0.5150164307230379,0.5187727514082403,0.522527822045104,0.5262826202118115,0.5300371054507527,0.5337914192017983,0.5375464935926217,0.5413014311482989,0.5450561095248925,0.5488117187514125,0.5525661768772355,0.5563235081702055,0.5600797579540071,0.5638369045836091,0.5675940102752802,0.5713520340493227,0.5751100369776962,0.5788679596972927,0.5826258959527332,0.5863828097619445,0.5901406674305801,0.593897573685252,0.597654419423444,0.6014093240653062,0.6051641624269574,0.6089160395607421,0.6126659299137229,0.6164157926020056,0.6201616886553919,0.6239065451618546,0.6276464255764156,0.6313842385203057,0.6351181073443843,0.6388469415665682,0.6425726931591681,0.6462914463669078,0.6500071247171884,0.6537147788902224,0.6574183247714932,0.6611128336141637,0.6648012725844235,0.6684815267484132,0.6721537530870352,0.6758177719435436,0.6794706989916038,0.6831154175921678,0.6867490315471613,0.6903714630144,0.6939836082650025,0.6975826171487558,0.7011702998442422,0.704742819719188,0.7083029725794211,0.7118479289119495,0.7153785887738957,0.7188938119708388,0.7223917868234861,0.7258742839343467,0.7293375175127107,0.7327852410807962,0.7362116391655383,0.7396196144261882,0.7430089883586135,0.7463760005250465,0.7497233760041233,0.7530473694983222,0.7563496686461588,0.7596285680800611,0.7628837001518682,0.7661133955136393,0.7693184668521016,0.7724987014653718,0.7756514499718966,0.7787783143950607,0.7818756741313698,0.7849460858913447,0.7879859567629643,0.7909960529255057,0.7939771294497029,0.7969256090092027,0.7998440132840018,0.8027288102158318,0.80558246359489,0.80840049484089,0.8111846130302013,0.8139344946962004,0.8166487205595967,0.8193276503392856,0.8219699071711365,0.8245747957604673,0.8271430102244819,0.8296721588204928,0.8321628664603256,0.8346148603683272,0.8370283618478455,0.8394011274151628,0.8417343479104805,0.8440258066445298,0.846277098641311,0.8484887693085125,0.8506586693743721,0.8527868884051059,0.8548743348948882,0.8569210584030033,0.8589260001543768,0.8608896727270254,0.8628135638060236,0.8646966714690255,0.8665399511423325,0.8683424453868425,0.8701070824773419,0.8718329499665033,0.8735204919838195,0.8751721361118794,0.8767870195906821,0.8783679817337392,0.8799142035724945,0.881428482695378,0.882912055742582,0.8843656662392944,0.8857905919469689,0.8871902151408768,0.8885638719723012,0.8899148892894538,0.8912449579301015,0.8925554087193903,0.8938489258169644,0.8951268587699225,0.8963915533178293,0.8976453379379864,0.8988895853765866,0.9001259343493543,0.9013577843655304,0.9025857610712735,0.903815286843018,0.905044655982066,0.9062782052563443,0.9075153058386868,0.9087596065041207,0.910011479184347,0.9112725641897205,0.9125452328290099};


template<typename Real>
constexpr const std::array<Real, 256> viridis_b{0.3310101940118055,0.3370344273837448,0.34299986027156143,0.3489014246790825,0.3547381197779056,0.3605089628592038,0.3662108687467896,0.37184193824445494,0.377402604549329,0.38288925650020894,0.38829907434247934,0.39363381249817775,0.39888773777233144,0.4040625134864877,0.4091545009758388,0.4141620022087494,0.419085269399855,0.4239197611787469,0.4286679531263877,0.43332440286164786,0.4378904725411851,0.4423628376506268,0.44674164765622,0.45102599429604956,0.45521366881321973,0.45930580962347606,0.4632993229731653,0.46719523432267124,0.4709905542704291,0.4746882091147527,0.47828532474775726,0.48178183314421624,0.4851796030849527,0.48847588346394805,0.4916733669375038,0.4947714272765002,0.4977706233250952,0.5006704469605663,0.5034736673089839,0.5061799701305794,0.5087899731598793,0.5113070173032073,0.513728818335263,0.5160606205820103,0.5183002465878732,0.520452297156245,0.5225163029836838,0.5244952101282286,0.5263910452541571,0.5282048535123068,0.5299405582099276,0.5315972918179168,0.5331785030475249,0.5346875949663166,0.5361247892898974,0.5374938454348637,0.5387960766501153,0.5400351419012158,0.541210431546397,0.5423272767396595,0.5433859495199381,0.5443899159864241,0.5453407090892604,0.5462408516171586,0.5470928102383564,0.5478981611011682,0.5486591285070745,0.5493769038436812,0.5500541290065128,0.550693159876779,0.5512956789400659,0.5518619993206375,0.5523958384505545,0.5528983516354158,0.553370667054746,0.5538155494173054,0.5542332292091459,0.5546244907783647,0.5549915450448365,0.5553351998790793,0.5556576460945991,0.5559587153582112,0.5562394960910725,0.5565020591903272,0.556746262161579,0.5569722290778042,0.557181850680197,0.5573752305636125,0.5575532711989851,0.5577160128723664,0.5578634992121222,0.5579966435791459,0.5581155142003147,0.5582210548062131,0.5583112863650675,0.5583881853088769,0.5584507478170652,0.5584999999185336,0.5585338908615732,0.5585544415094105,0.5585596247099263,0.5585494296782225,0.5585238597828509,0.5584829093200094,0.5584245259010897,0.5583487508089193,0.5582545074731591,0.5581428559806787,0.5580117160916531,0.5578601343029762,0.5576870630720852,0.5574934462432263,0.5572763581459699,0.5570376811361709,0.5567735144515659,0.5564836952783472,0.556167356233582,0.5558234063897372,0.5554507440723478,0.5550485162697486,0.5546145021343457,0.5541489011713485,0.5536514862639709,0.5531194414635993,0.5525516502615303,0.551946905668582,0.5513055188601756,0.5506231120862802,0.5499020260312123,0.5491378466444521,0.5483329604685923,0.5474829147739082,0.5465891203401918,0.5456483318142806,0.5446602664371812,0.5436233831996301,0.5425371443011318,0.5413990511580228,0.5402105175168492,0.5389691120794025,0.5376724808099055,0.5363202416485567,0.5349120639299949,0.5334461775790392,0.5319223153351261,0.5303396509309062,0.528695928325246,0.5269907342678339,0.5252235696860159,0.5233932929927063,0.5214978927023376,0.519538336475508,0.5175125345875667,0.5154205123723917,0.5132606594914964,0.511032405517675,0.5087347666999795,0.5063675657201724,0.5039309536083489,0.5014215766343267,0.49884168959711156,0.4961885702691708,0.493462471806926,0.49066268626229187,0.48778873213754487,0.4848389747066589,0.48181384166285274,0.47871379185797663,0.4755369438569324,0.4722824057138442,0.46895172451554185,0.4655431005241239,0.46205513288486627,0.45848792117067955,0.45484323921432873,0.45111796445512237,0.44731304660604426,0.4434292850786966,0.4394635038573973,0.4354175943073504,0.43128829183503475,0.42707853717913047,0.4227860189043366,0.4184127227273974,0.4139573287646593,0.40941845760197537,0.40479818880388174,0.4000928616204019,0.3953036041833475,0.39042968981612,0.3854733248017807,0.3804329133629437,0.37530572247730154,0.3700971086652205,0.3648008403071768,0.35942126510781447,0.353955095785225,0.348402577877059,0.3427637682343151,0.3370376142646351,0.33122632945843844,0.32532725843019283,0.3193425718381236,0.31327047427719934,0.30711089679069037,0.300864481689657,0.2945294594583805,0.2881066671370873,0.2815945980811821,0.27499396246121266,0.2683017620352695,0.2615237686948751,0.2546561143755624,0.24769889915726157,0.24065414755310766,0.23351750058916276,0.22629568729131472,0.21898246061294346,0.21158392883280225,0.2040979693981519,0.19652278866190287,0.18886521134133236,0.181121291501226,0.1732986740171394,0.16539484611862115,0.1574190301339476,0.14937219444590882,0.1412584133407773,0.13309191286806318,0.1248770398795781,0.11663311070005217,0.10837392920767788,0.10012807215776806,0.09192536612477004,0.08380928749785493,0.07583905286235423,0.0680900722152191,0.06066995495444857,0.05371196587603636,0.047401117840516725,0.04195435979844082,0.03764562984062277,0.034852646118004794,0.033642700571396934,0.034045498308027174,0.036085858895558834,0.03978910711211607,0.04495402504133204,0.05123011464126393,0.05838119124087505,0.06620564078749713,0.07453488746258119,0.0832510020840733,0.09225150797640028,0.10147371721450577,0.11085876909361342};

template<typename Real>
vec<Real, 3> viridis(Real scalar) {
    scalar = std::clamp(scalar, Real(0), Real(1));
    // Keep ASAN happy:
    if (scalar == 1) {
        return vec<Real>(viridis_r<Real>.back(),
                   viridis_g<Real>.back(),
                   viridis_b<Real>.back());
    }
    constexpr const Real h = Real(1)/(viridis_r<Real>.size()-1);
    Real ii = std::floor(scalar/h);
    int i = static_cast<int64_t>(ii);
    Real t = scalar/h - ii;

    auto color = vec<Real, 3>((1-t)*viridis_r<Real>[i] + t*viridis_r<Real>[i+1],
                              (1-t)*viridis_g<Real>[i] + t*viridis_g<Real>[i+1],
                              (1-t)*viridis_b<Real>[i] + t*viridis_b<Real>[i+1]);
    return color;
}



}
#endif